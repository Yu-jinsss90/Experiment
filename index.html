<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Square Dodger</title>
<style>
  body {
    margin: 0;
    background: linear-gradient(to bottom, #f8fafc, #e2e8f0);
    font-family: sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
    user-select: none;
  }
  #game-container {
    background: white;
    padding: 10px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    text-align: center;
  }
  canvas {
    background: white;
    border-radius: 10px;
    display: block;
  }
  button {
    padding: 8px 16px;
    margin: 6px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    background: #0ea5e9;
    color: white;
    font-size: 14px;
  }
  button:hover {
    background: #0284c7;
  }
  #scoreboard {
    font-weight: bold;
    margin-bottom: 6px;
  }
</style>
</head>
<body>

<div id="game-container">
  <div id="scoreboard">Score: 0 | Best: 0</div>
  <canvas id="gameCanvas" width="360" height="540"></canvas><br>
  <button id="startBtn">Start</button>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const startBtn = document.getElementById("startBtn");
const scoreboard = document.getElementById("scoreboard");

let player = { x: 160, y: 480, size: 28, speed: 5 };
let obstacles = [];
let running = false;
let score = 0;
let best = parseInt(localStorage.getItem("square_dodger_best")) || 0;
let keys = {};

function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }
function rand(min, max) { return Math.random() * (max - min) + min; }

document.addEventListener("keydown", e => { keys[e.key] = true; });
document.addEventListener("keyup", e => { keys[e.key] = false; });

function resetGame() {
  score = 0;
  player.x = 160;
  player.y = 480;
  obstacles = [];
}

function spawnObstacle() {
  const w = rand(24, 60);
  const h = rand(14, 28);
  const x = rand(4, canvas.width - w - 4);
  const vy = rand(2.2, 3.6);
  obstacles.push({ x, y: -h, w, h, vy });
}

let spawnTimer = 0;
function update() {
  if (!running) return;

  // Player movement
  if (keys["ArrowLeft"] || keys["a"]) player.x -= player.speed;
  if (keys["ArrowRight"] || keys["d"]) player.x += player.speed;
  player.x = clamp(player.x, 4, canvas.width - player.size - 4);

  // Spawn obstacles
  spawnTimer -= 16;
  if (spawnTimer <= 0) {
    spawnObstacle();
    spawnTimer = 600 + rand(-120, 120);
  }

  // Update obstacles
  for (let i = obstacles.length - 1; i >= 0; i--) {
    const o = obstacles[i];
    o.y += o.vy;
    if (o.y > canvas.height + 40) {
      obstacles.splice(i, 1);
      score++;
    }
  }

  // Collision detection
  for (const o of obstacles) {
    if (
      player.x < o.x + o.w &&
      player.x + player.size > o.x &&
      player.y < o.y + o.h &&
      player.y + player.size > o.y
    ) {
      gameOver();
    }
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Player
  ctx.fillStyle = "#0ea5e9";
  ctx.fillRect(player.x, player.y, player.size, player.size);

  // Obstacles
  ctx.fillStyle = "#ef4444";
  for (const o of obstacles) {
    ctx.fillRect(o.x, o.y, o.w, o.h);
  }

  scoreboard.textContent = `Score: ${score} | Best: ${best}`;
}

function loop() {
  update();
  draw();
  if (running) requestAnimationFrame(loop);
}

function startGame() {
  resetGame();
  running = true;
  loop();
}

function gameOver() {
  running = false;
  best = Math.max(best, score);
  localStorage.setItem("square_dodger_best", best);
  alert(`Game Over! Your score: ${score}`);
}

startBtn.addEventListener("click", startGame);
</script>

</body>
</html>
